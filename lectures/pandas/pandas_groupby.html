
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta property="og:title" content="Pandas: Groupby" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://hgamarro.github.io/wrf-docs/lectures/pandas/pandas_groupby.html" />
<meta property="og:site_name" content="Python" />
<meta property="og:description" content="groupby is an amazingly powerful function in pandas. But it is also complicated to use and understand. The point of this lesson is to make you feel confident in using groupby and its cousins, resam..." />
<meta property="og:image" content="https://hgamarro.github.io/wrf-docs/_images/pandas_groupby_5_1.png" />
<meta property="og:image:alt" content="Python" />
<meta name="description" content="groupby is an amazingly powerful function in pandas. But it is also complicated to use and understand. The point of this lesson is to make you feel confident in using groupby and its cousins, resam..." />

    <title>Pandas: Groupby &#8212; Weather Data Science</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://hgamarro.github.io/wrf-docs/lectures/pandas/pandas_groupby.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Assignment: Pandas Groupby with Hurricane Data" href="../../assignments/pandas_groupby.html" />
    <link rel="prev" title="Assignment: Pandas Fundamentals with Earthquake Data" href="../../assignments/basic_pandas.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/eeds-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Weather Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    An Introduction to Earth and Environmental Data Science
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About this Book
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../LICENSE.html">
   License for this book
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The Interactive Computing Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../environment/intro_to_jupyterlab.html">
   Intro to JupyterLab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../environment/env_setup.html">
   Environment Setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../environment/intro_to_unix.html">
   Intro to Unix
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../environment/data.html">
   All About Data
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The Core Python Language
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../core_python/python_fundamentals.html">
   Python Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../core_python/functions_classes.html">
   Python Functions and Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/python_basics_and_functions.html">
   Assignment: Basic Python
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Scientific Python Fundamentals
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../basic_scipy/numpy_and_matplotlib.html">
   Numpy and Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/numpy_matplotlib.html">
   Assignment: Numpy and Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../basic_scipy/more_matplotlib.html">
   More Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/more_matplotlib.html">
   Assignment: More Matplotlib
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  High Level Data Analysis Frameworks
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="pandas_intro.html">
   Pandas
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="basic_pandas.html">
     Pandas Fundamentals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../assignments/basic_pandas.html">
     Assignment: Pandas Fundamentals with Earthquake Data
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Pandas: Groupby
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../assignments/pandas_groupby.html">
     Assignment: Pandas Groupby with Hurricane Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../xarray/xarray_intro.html">
   Xarray for multidimensional gridded data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../xarray/xarray.html">
     Xarray Fundamentals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../xarray/part2_xarray.html">
     Xarray Interpolation, Groupby, Resample, Rolling, and Coarsen
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Geoscience Package
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../basic_scipy/mapping_cartopy.html">
   Maps in Scientific Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/cartopy.html">
   Assignment: Making Maps with Cartopy
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Climate Model Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../models/intro_models.html">
   Working With Earth Science Model Output
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/hgamarro/wrf-docs/master?urlpath=tree/src/lectures/pandas/pandas_groupby.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/hgamarro/wrf-docs"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/hgamarro/wrf-docs/issues/new?title=Issue%20on%20page%20%2Flectures/pandas/pandas_groupby.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/hgamarro/wrf-docs/edit/master/src/lectures/pandas/pandas_groupby.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/lectures/pandas/pandas_groupby.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-example">
   An Example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-happened">
   What Happened?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-groupby-method">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       groupby
      </span>
     </code>
     method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-groubby-object">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       GroubBy
      </span>
     </code>
     object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iterating-and-selecting-groups">
     Iterating and selecting groups
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregation">
   Aggregation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transformation">
   Transformation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#time-grouping">
   Time Grouping
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculating-anomalies">
     Calculating anomalies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#resampling">
     Resampling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rolling-operations">
     Rolling Operations
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Pandas: Groupby</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-example">
   An Example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-happened">
   What Happened?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-groupby-method">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       groupby
      </span>
     </code>
     method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-groubby-object">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       GroubBy
      </span>
     </code>
     object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iterating-and-selecting-groups">
     Iterating and selecting groups
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregation">
   Aggregation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transformation">
   Transformation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#time-grouping">
   Time Grouping
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculating-anomalies">
     Calculating anomalies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#resampling">
     Resampling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rolling-operations">
     Rolling Operations
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="pandas-groupby">
<h1>Pandas: Groupby<a class="headerlink" href="#pandas-groupby" title="Permalink to this headline">#</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">groupby</span></code> is an amazingly powerful function in pandas. But it is also complicated to use and understand.
The point of this lesson is to make you feel confident in using <code class="docutils literal notranslate"><span class="pre">groupby</span></code> and its cousins, <code class="docutils literal notranslate"><span class="pre">resample</span></code> and <code class="docutils literal notranslate"><span class="pre">rolling</span></code>.</p>
<p>These notes are loosely based on the <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/groupby.html">Pandas GroupBy Documentation</a>.</p>
<p>The “split/apply/combine” concept was first introduced in a paper by Hadley Wickham: <a class="reference external" href="https://www.jstatsoft.org/article/view/v040i01">https://www.jstatsoft.org/article/view/v040i01</a>.</p>
<p>Imports:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
<span class="c1"># %matplotlib inline</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First we read the Earthquake data from our previous assignment:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../assignments/data/query.csv&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">place</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">df_small</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">mag</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">mag</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>depth</th>
      <th>mag</th>
      <th>magType</th>
      <th>nst</th>
      <th>gap</th>
      <th>dmin</th>
      <th>rms</th>
      <th>...</th>
      <th>place</th>
      <th>type</th>
      <th>horizontalError</th>
      <th>depthError</th>
      <th>magError</th>
      <th>magNst</th>
      <th>status</th>
      <th>locationSource</th>
      <th>magSource</th>
      <th>country</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>usc000swlj</th>
      <td>2014-10-31 23:58:39.420000+00:00</td>
      <td>-22.4417</td>
      <td>-179.0532</td>
      <td>442.29</td>
      <td>4.1</td>
      <td>mb</td>
      <td>NaN</td>
      <td>57.0</td>
      <td>5.406</td>
      <td>0.76</td>
      <td>...</td>
      <td>south of the Fiji Islands</td>
      <td>earthquake</td>
      <td>6.3</td>
      <td>9.8</td>
      <td>0.103</td>
      <td>27.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
      <td>south of the Fiji Islands</td>
    </tr>
    <tr>
      <th>usc000sta3</th>
      <td>2014-10-31 23:15:33.940000+00:00</td>
      <td>40.3453</td>
      <td>71.5875</td>
      <td>10.00</td>
      <td>4.4</td>
      <td>mb</td>
      <td>NaN</td>
      <td>46.0</td>
      <td>0.653</td>
      <td>1.36</td>
      <td>...</td>
      <td>10 km ESE of Oltiariq, Uzbekistan</td>
      <td>earthquake</td>
      <td>2.9</td>
      <td>1.8</td>
      <td>0.117</td>
      <td>24.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
      <td>Uzbekistan</td>
    </tr>
    <tr>
      <th>usc000st9z</th>
      <td>2014-10-31 23:00:04+00:00</td>
      <td>45.1647</td>
      <td>22.2912</td>
      <td>4.10</td>
      <td>4.1</td>
      <td>mwr</td>
      <td>NaN</td>
      <td>74.0</td>
      <td>0.410</td>
      <td>1.00</td>
      <td>...</td>
      <td>1 km NNE of Teregova, Romania</td>
      <td>earthquake</td>
      <td>3.1</td>
      <td>1.7</td>
      <td>0.053</td>
      <td>34.0</td>
      <td>reviewed</td>
      <td>buc</td>
      <td>us</td>
      <td>Romania</td>
    </tr>
    <tr>
      <th>usc000st9w</th>
      <td>2014-10-31 22:45:19.200000+00:00</td>
      <td>-4.5943</td>
      <td>153.0138</td>
      <td>66.11</td>
      <td>4.8</td>
      <td>mb</td>
      <td>NaN</td>
      <td>51.0</td>
      <td>0.937</td>
      <td>0.74</td>
      <td>...</td>
      <td>87 km ESE of Kokopo, Papua New Guinea</td>
      <td>earthquake</td>
      <td>5.3</td>
      <td>5.1</td>
      <td>0.054</td>
      <td>108.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
      <td>Papua New Guinea</td>
    </tr>
    <tr>
      <th>usc000st92</th>
      <td>2014-10-31 21:32:26.100000+00:00</td>
      <td>64.6210</td>
      <td>-17.7770</td>
      <td>10.40</td>
      <td>5.0</td>
      <td>mb</td>
      <td>NaN</td>
      <td>34.0</td>
      <td>1.531</td>
      <td>0.78</td>
      <td>...</td>
      <td>119 km S of Akureyri, Iceland</td>
      <td>earthquake</td>
      <td>5.8</td>
      <td>3.5</td>
      <td>0.029</td>
      <td>417.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
      <td>Iceland</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 22 columns</p>
</div></div></div>
</div>
<section id="an-example">
<h2>An Example<a class="headerlink" href="#an-example" title="Permalink to this headline">#</a></h2>
<p>This is an example of a “one-liner” that you can accomplish with groupby.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mag</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;country&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/pandas_groupby_5_1.png" src="../../_images/pandas_groupby_5_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_small</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mag</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;country&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/pandas_groupby_6_1.png" src="../../_images/pandas_groupby_6_1.png" />
</div>
</div>
</section>
<section id="what-happened">
<h2>What Happened?<a class="headerlink" href="#what-happened" title="Permalink to this headline">#</a></h2>
<p>Let’s break apart this operation a bit. The workflow with <code class="docutils literal notranslate"><span class="pre">groubpy</span></code> can be divided into three general steps:</p>
<ol class="simple">
<li><p><strong>Split</strong>: Partition the data into different groups based on some criterion.</p></li>
<li><p><strong>Apply</strong>: Do some caclulation within each group. Different types of “apply” steps might be</p></li>
<li><p><em>Aggregation</em>: Get the mean or max within the group.</p></li>
<li><p><em>Transformation</em>: Normalize all the values within a group</p></li>
<li><p><em>Filtration</em>: Eliminate some groups based on a criterion.</p></li>
<li><p><strong>Combine</strong>: Put the results back together into a single object.</p></li>
</ol>
<p><img alt="split-apply-combine" src="https://miro.medium.com/max/1840/1*JbF6nhrQsn4f-TaSF6IR9g.png" /></p>
<section id="the-groupby-method">
<h3>The <code class="docutils literal notranslate"><span class="pre">groupby</span></code> method<a class="headerlink" href="#the-groupby-method" title="Permalink to this headline">#</a></h3>
<p>Both <code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> objects have a groupby method. It accepts a variety of arguments, but the simplest way to think about it is that you pass another series, whose unique values are used to split the original object into different groups.</p>
<p>via <a class="reference external" href="https://medium.com/analytics-vidhya/split-apply-combine-strategy-for-data-mining-4fd6e2a0cc99">https://medium.com/analytics-vidhya/split-apply-combine-strategy-for-data-mining-4fd6e2a0cc99</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">country</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x151551d542d0&gt;
</pre></div>
</div>
</div>
</div>
<p>There is a shortcut for doing this with dataframes: you just pass the column name:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x151551d39220&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-groubby-object">
<h3>The <code class="docutils literal notranslate"><span class="pre">GroubBy</span></code> object<a class="headerlink" href="#the-groubby-object" title="Permalink to this headline">#</a></h3>
<p>When we call, <code class="docutils literal notranslate"><span class="pre">groupby</span></code> we get back a <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span>
<span class="n">gb</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x151551d395b0&gt;
</pre></div>
</div>
</div>
</div>
<p>The length tells us how many groups were found:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">gb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>267
</pre></div>
</div>
</div>
</div>
<p>All of the groups are available as a dictionary via the <code class="docutils literal notranslate"><span class="pre">.groups</span></code> attribute:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="n">gb</span><span class="o">.</span><span class="n">groups</span>
<span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>267
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Afghanistan&#39;,
 &#39;Afghanistan-Tajikistan-Pakistan region&#39;,
 &#39;Alaska&#39;,
 &#39;Albania&#39;,
 &#39;Algeria&#39;,
 &#39;Anguilla&#39;,
 &#39;Antigua and Barbuda&#39;,
 &#39;Argentina&#39;,
 &#39;Arizona&#39;,
 &#39;Ascension Island region&#39;,
 &#39;Australia&#39;,
 &#39;Azerbaijan&#39;,
 &#39;Azores Islands region&#39;,
 &#39;Azores-Cape St. Vincent Ridge&#39;,
 &#39;Baffin Bay&#39;,
 &#39;Balleny Islands region&#39;,
 &#39;Banda Sea&#39;,
 &#39;Bangladesh&#39;,
 &#39;Bay of Bengal&#39;,
 &#39;Beaufort Sea&#39;,
 &#39;Bermuda&#39;,
 &#39;Bismarck Sea&#39;,
 &#39;Bolivia&#39;,
 &#39;Bosnia and Herzegovina&#39;,
 &#39;Bouvet Island region&#39;,
 &#39;Brazil&#39;,
 &#39;Burundi&#39;,
 &#39;CA&#39;,
 &#39;California&#39;,
 &#39;California Earthquake&#39;,
 &#39;Canada&#39;,
 &#39;Carlsberg Ridge&#39;,
 &#39;Cayman Islands&#39;,
 &#39;Celebes Sea&#39;,
 &#39;Central Alaska&#39;,
 &#39;Central Turkey&#39;,
 &#39;Chagos Archipelago region&#39;,
 &#39;Chile&#39;,
 &#39;Chile-Bolivia border region&#39;,
 &#39;China&#39;,
 &#39;Colombia&#39;,
 &#39;Colombia-Ecuador border region&#39;,
 &#39;Comoros&#39;,
 &#39;Costa Rica&#39;,
 &#39;Crozet Islands region&#39;,
 &#39;Cuba&#39;,
 &#39;Cuba region&#39;,
 &#39;Cyprus&#39;,
 &quot;D&#39;Entrecasteaux Islands region&quot;,
 &#39;Davis Strait&#39;,
 &#39;Djibouti&#39;,
 &#39;Dominica&#39;,
 &#39;Dominican Republic&#39;,
 &#39;East Timor region&#39;,
 &#39;Easter Island region&#39;,
 &#39;Ecuador&#39;,
 &#39;Ecuador region&#39;,
 &#39;Egypt&#39;,
 &#39;El Salvador&#39;,
 &#39;Eritrea&#39;,
 &#39;Ethiopia&#39;,
 &#39;Falkland Islands region&#39;,
 &#39;Federated States of Micronesia&#39;,
 &#39;Federated States of Micronesia region&#39;,
 &#39;Fiji&#39;,
 &#39;Fiji region&#39;,
 &#39;France&#39;,
 &#39;French Polynesia&#39;,
 &#39;French Southern Territories&#39;,
 &#39;Georgia&#39;,
 &#39;Greece&#39;,
 &#39;Greenland&#39;,
 &#39;Greenland Sea&#39;,
 &#39;Guadeloupe&#39;,
 &#39;Guam&#39;,
 &#39;Guam region&#39;,
 &#39;Guatemala&#39;,
 &#39;Gulf of Aden&#39;,
 &#39;Gulf of Alaska&#39;,
 &#39;Haiti&#39;,
 &#39;Hawaii&#39;,
 &#39;Honduras&#39;,
 &#39;Iceland&#39;,
 &#39;Idaho&#39;,
 &#39;India&#39;,
 &#39;India region&#39;,
 &#39;Indian Ocean Triple Junction&#39;,
 &#39;Indonesia&#39;,
 &#39;Iran&#39;,
 &#39;Iran-Iraq border region&#39;,
 &#39;Iraq&#39;,
 &#39;Italy&#39;,
 &#39;Jan Mayen Island region&#39;,
 &#39;Japan&#39;,
 &#39;Japan region&#39;,
 &#39;Jordan&#39;,
 &#39;Kansas&#39;,
 &#39;Kashmir-Xinjiang border region&#39;,
 &#39;Kazakhstan&#39;,
 &#39;Kazakhstan-Xinjiang border region&#39;,
 &#39;Kermadec Islands region&#39;,
 &#39;Kuril Islands&#39;,
 &#39;Kyrgyzstan&#39;,
 &#39;Kyrgyzstan-Tajikistan border region&#39;,
 &#39;Kyrgyzstan-Xinjiang border region&#39;,
 &#39;Labrador Sea&#39;,
 &#39;Laos&#39;,
 &#39;Laptev Sea&#39;,
 &#39;MX&#39;,
 &#39;Macquarie Island region&#39;,
 &#39;Malaysia&#39;,
 &#39;Mariana Islands region&#39;,
 &#39;Martinique&#39;,
 &#39;Mauritania&#39;,
 &#39;Mauritius - Reunion region&#39;,
 &#39;Mexico&#39;,
 &#39;Micronesia&#39;,
 &#39;Mid-Indian Ridge&#39;,
 &#39;Molucca Sea&#39;,
 &#39;Mongolia&#39;,
 &#39;Montenegro&#39;,
 &#39;Morocco&#39;,
 &#39;Mozambique&#39;,
 &#39;Mozambique Channel&#39;,
 &#39;Myanmar&#39;,
 &#39;Myanmar-China border region&#39;,
 &#39;Nepal&#39;,
 &#39;New Caledonia&#39;,
 &#39;New Zealand&#39;,
 &#39;New Zealand region&#39;,
 &#39;Nicaragua&#39;,
 &#39;North Atlantic Ocean&#39;,
 &#39;North Indian Ocean&#39;,
 &#39;North Island of New Zealand&#39;,
 &#39;North Korea&#39;,
 &#39;Northern Mariana Islands&#39;,
 &#39;Norway&#39;,
 &#39;Norwegian Sea&#39;,
 &#39;Oklahoma&#39;,
 &#39;Oman&#39;,
 &#39;Oregon&#39;,
 &#39;Owen Fracture Zone region&#39;,
 &#39;Pacific-Antarctic Ridge&#39;,
 &#39;Pakistan&#39;,
 &#39;Palau&#39;,
 &#39;Panama&#39;,
 &#39;Papua New Guinea&#39;,
 &#39;Peru&#39;,
 &#39;Philippine Islands region&#39;,
 &#39;Philippines&#39;,
 &#39;Poland&#39;,
 &#39;Portugal&#39;,
 &#39;Prince Edward Islands region&#39;,
 &#39;Puerto Rico&#39;,
 &#39;Revilla Gigedo Islands region&#39;,
 &#39;Reykjanes Ridge&#39;,
 &#39;Romania&#39;,
 &#39;Russia&#39;,
 &#39;Russia region&#39;,
 &#39;Saint Helena&#39;,
 &#39;Saint Vincent and the Grenadines&#39;,
 &#39;Samoa&#39;,
 &#39;Santa Cruz Islands&#39;,
 &#39;Saudi Arabia&#39;,
 &#39;Scotia Sea&#39;,
 &#39;Sea of Okhotsk&#39;,
 &#39;Slovenia&#39;,
 &#39;Socotra region&#39;,
 &#39;Solomon Islands&#39;,
 &#39;Somalia&#39;,
 &#39;South Africa&#39;,
 &#39;South Atlantic Ocean&#39;,
 &#39;South Georgia Island region&#39;,
 &#39;South Indian Ocean&#39;,
 &#39;South Sandwich Islands region&#39;,
 &#39;South Shetland Islands&#39;,
 &#39;Southwest Indian Ridge&#39;,
 &#39;Spain&#39;,
 &#39;Sudan&#39;,
 &#39;Svalbard and Jan Mayen&#39;,
 &#39;Sweden&#39;,
 &#39;Syria&#39;,
 &#39;Taiwan&#39;,
 &#39;Taiwan region&#39;,
 &#39;Tajikistan&#39;,
 &#39;Tajikistan-Xinjiang border region&#39;,
 &#39;Tanzania&#39;,
 &#39;Thailand&#39;,
 &#39;Timor Leste&#39;,
 &#39;Tonga&#39;,
 &#39;Tonga region&#39;,
 &#39;Trinidad and Tobago&#39;,
 &#39;Tristan da Cunha region&#39;,
 &#39;Turkey&#39;,
 &#39;Turkmenistan&#39;,
 &#39;U.S. Virgin Islands&#39;,
 &#39;Uganda&#39;,
 &#39;Ukraine&#39;,
 &#39;Utah&#39;,
 &#39;Uzbekistan&#39;,
 &#39;Vanuatu&#39;,
 &#39;Vanuatu region&#39;,
 &#39;Venezuela&#39;,
 &#39;Vietnam&#39;,
 &#39;Wallis and Futuna&#39;,
 &#39;West Chile Rise&#39;,
 &#39;Western Australia&#39;,
 &#39;Western Turkey&#39;,
 &#39;Wyoming&#39;,
 &#39;Xizang-Qinghai border region&#39;,
 &#39;Yemen&#39;,
 &#39;Zambia&#39;,
 &#39;central East Pacific Rise&#39;,
 &#39;central Mid-Atlantic Ridge&#39;,
 &#39;central Peru&#39;,
 &#39;east of Severnaya Zemlya&#39;,
 &#39;east of the Kuril Islands&#39;,
 &#39;east of the North Island of New Zealand&#39;,
 &#39;east of the Philippine Islands&#39;,
 &#39;east of the South Sandwich Islands&#39;,
 &#39;eastern Turkey&#39;,
 &#39;near the coast of Ecuador&#39;,
 &#39;near the coast of Nicaragua&#39;,
 &#39;near the coast of central Peru&#39;,
 &#39;near the south coast of Myanmar&#39;,
 &#39;near the west coast of Colombia&#39;,
 &#39;north of Ascension Island&#39;,
 &#39;north of Franz Josef Land&#39;,
 &#39;north of New Zealand&#39;,
 &#39;north of Severnaya Zemlya&#39;,
 &#39;north of Svalbard&#39;,
 &#39;northern Alaska&#39;,
 &#39;northern East Pacific Rise&#39;,
 &#39;northern Mid-Atlantic Ridge&#39;,
 &#39;northwest of Australia&#39;,
 &#39;northwest of the Kuril Islands&#39;,
 &#39;off the coast of Central America&#39;,
 &#39;off the coast of Ecuador&#39;,
 &#39;off the coast of Oregon&#39;,
 &#39;off the east coast of the North Island of New Zealand&#39;,
 &#39;off the west coast of northern Sumatra&#39;,
 &#39;south of Africa&#39;,
 &#39;south of Australia&#39;,
 &#39;south of Panama&#39;,
 &#39;south of Tonga&#39;,
 &#39;south of the Fiji Islands&#39;,
 &#39;south of the Kermadec Islands&#39;,
 &#39;south of the Mariana Islands&#39;,
 &#39;southeast Indian Ridge&#39;,
 &#39;southeast central Pacific Ocean&#39;,
 &#39;southeast of Easter Island&#39;,
 &#39;southeast of the Loyalty Islands&#39;,
 &#39;southern East Pacific Rise&#39;,
 &#39;southern Iran&#39;,
 &#39;southern Mid-Atlantic Ridge&#39;,
 &#39;southern Pacific Ocean&#39;,
 &#39;southern Peru&#39;,
 &#39;southwest of Africa&#39;,
 &#39;southwest of Australia&#39;,
 &#39;southwestern Atlantic Ocean&#39;,
 &#39;west of Australia&#39;,
 &#39;west of Macquarie Island&#39;,
 &#39;west of Vancouver Island&#39;,
 &#39;west of the Galapagos Islands&#39;,
 &#39;western Greenland&#39;,
 &#39;western Indian-Antarctic Ridge&#39;,
 &#39;western Xizang&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="iterating-and-selecting-groups">
<h3>Iterating and selecting groups<a class="headerlink" href="#iterating-and-selecting-groups" title="Permalink to this headline">#</a></h3>
<p>You can loop through the groups if you want.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">gb</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The key is &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>depth</th>
      <th>mag</th>
      <th>magType</th>
      <th>nst</th>
      <th>gap</th>
      <th>dmin</th>
      <th>rms</th>
      <th>...</th>
      <th>place</th>
      <th>type</th>
      <th>horizontalError</th>
      <th>depthError</th>
      <th>magError</th>
      <th>magNst</th>
      <th>status</th>
      <th>locationSource</th>
      <th>magSource</th>
      <th>country</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>usb000sr62</th>
      <td>2014-10-28 18:52:11.630000+00:00</td>
      <td>36.5171</td>
      <td>71.3805</td>
      <td>94.86</td>
      <td>4.5</td>
      <td>mb</td>
      <td>NaN</td>
      <td>74.0</td>
      <td>0.886</td>
      <td>1.10</td>
      <td>...</td>
      <td>22 km SW of Ashk?sham, Afghanistan</td>
      <td>earthquake</td>
      <td>5.4</td>
      <td>6.6</td>
      <td>0.096</td>
      <td>37.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
      <td>Afghanistan</td>
    </tr>
    <tr>
      <th>usb000sr0a</th>
      <td>2014-10-28 00:54:22.490000+00:00</td>
      <td>36.5401</td>
      <td>70.9566</td>
      <td>156.80</td>
      <td>4.1</td>
      <td>mb</td>
      <td>NaN</td>
      <td>76.0</td>
      <td>0.659</td>
      <td>0.88</td>
      <td>...</td>
      <td>37 km SSE of Jurm, Afghanistan</td>
      <td>earthquake</td>
      <td>3.0</td>
      <td>5.6</td>
      <td>0.105</td>
      <td>26.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
      <td>Afghanistan</td>
    </tr>
    <tr>
      <th>usb000sqa0</th>
      <td>2014-10-24 09:52:48.730000+00:00</td>
      <td>36.5657</td>
      <td>71.1712</td>
      <td>94.52</td>
      <td>4.5</td>
      <td>mb</td>
      <td>NaN</td>
      <td>71.0</td>
      <td>0.735</td>
      <td>1.47</td>
      <td>...</td>
      <td>34 km WSW of Ashk?sham, Afghanistan</td>
      <td>earthquake</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>0.111</td>
      <td>25.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
      <td>Afghanistan</td>
    </tr>
    <tr>
      <th>usb000sq97</th>
      <td>2014-10-24 03:17:05.650000+00:00</td>
      <td>36.6557</td>
      <td>71.1489</td>
      <td>78.97</td>
      <td>4.5</td>
      <td>mb</td>
      <td>NaN</td>
      <td>70.0</td>
      <td>0.656</td>
      <td>1.25</td>
      <td>...</td>
      <td>34 km W of Ashk?sham, Afghanistan</td>
      <td>earthquake</td>
      <td>5.3</td>
      <td>5.7</td>
      <td>0.136</td>
      <td>28.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
      <td>Afghanistan</td>
    </tr>
    <tr>
      <th>usb000spi8</th>
      <td>2014-10-21 17:35:25.340000+00:00</td>
      <td>36.3417</td>
      <td>70.5034</td>
      <td>175.12</td>
      <td>4.2</td>
      <td>mb</td>
      <td>NaN</td>
      <td>75.0</td>
      <td>0.784</td>
      <td>0.86</td>
      <td>...</td>
      <td>Hindu Kush region, Afghanistan</td>
      <td>earthquake</td>
      <td>7.7</td>
      <td>8.2</td>
      <td>0.132</td>
      <td>18.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
      <td>Afghanistan</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 22 columns</p>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The key is &quot;Afghanistan&quot;
</pre></div>
</div>
</div>
</div>
<p>And you can get a specific group by key.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s1">&#39;Chile&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>depth</th>
      <th>mag</th>
      <th>magType</th>
      <th>nst</th>
      <th>gap</th>
      <th>dmin</th>
      <th>rms</th>
      <th>...</th>
      <th>place</th>
      <th>type</th>
      <th>horizontalError</th>
      <th>depthError</th>
      <th>magError</th>
      <th>magNst</th>
      <th>status</th>
      <th>locationSource</th>
      <th>magSource</th>
      <th>country</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>usb000srx7</th>
      <td>2014-10-31 04:23:04+00:00</td>
      <td>-34.5790</td>
      <td>-71.0550</td>
      <td>75.90</td>
      <td>4.1</td>
      <td>mb</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.61</td>
      <td>...</td>
      <td>Libertador General Bernardo O'Higgins, Chile</td>
      <td>earthquake</td>
      <td>7.2</td>
      <td>5.5</td>
      <td>0.368</td>
      <td>7.0</td>
      <td>reviewed</td>
      <td>guc</td>
      <td>us</td>
      <td>Chile</td>
    </tr>
    <tr>
      <th>usb000srwp</th>
      <td>2014-10-31 02:46:43+00:00</td>
      <td>-19.3900</td>
      <td>-69.1960</td>
      <td>113.40</td>
      <td>4.4</td>
      <td>mwr</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.02</td>
      <td>...</td>
      <td>135 km NE of Iquique, Chile</td>
      <td>earthquake</td>
      <td>6.4</td>
      <td>4.2</td>
      <td>0.055</td>
      <td>32.0</td>
      <td>reviewed</td>
      <td>guc</td>
      <td>us</td>
      <td>Chile</td>
    </tr>
    <tr>
      <th>usb000squ4</th>
      <td>2014-10-27 06:07:23.410000+00:00</td>
      <td>-34.5269</td>
      <td>-73.4779</td>
      <td>17.97</td>
      <td>4.4</td>
      <td>mb</td>
      <td>NaN</td>
      <td>100.0</td>
      <td>1.362</td>
      <td>0.94</td>
      <td>...</td>
      <td>132 km NW of Constitución, Chile</td>
      <td>earthquake</td>
      <td>4.5</td>
      <td>5.9</td>
      <td>0.537</td>
      <td>1.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
      <td>Chile</td>
    </tr>
    <tr>
      <th>usb000sqp0</th>
      <td>2014-10-26 02:52:53+00:00</td>
      <td>-20.5680</td>
      <td>-70.5530</td>
      <td>44.80</td>
      <td>4.7</td>
      <td>mb</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.26</td>
      <td>...</td>
      <td>57 km SW of Iquique, Chile</td>
      <td>earthquake</td>
      <td>4.9</td>
      <td>4.1</td>
      <td>0.110</td>
      <td>52.0</td>
      <td>reviewed</td>
      <td>guc</td>
      <td>us</td>
      <td>Chile</td>
    </tr>
    <tr>
      <th>usc000sv1u</th>
      <td>2014-10-25 20:21:47+00:00</td>
      <td>-33.2970</td>
      <td>-69.7940</td>
      <td>8.10</td>
      <td>4.1</td>
      <td>mb</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.07</td>
      <td>...</td>
      <td>75 km ENE of Villa Presidente Frei, Ñuñoa, San...</td>
      <td>earthquake</td>
      <td>3.8</td>
      <td>4.3</td>
      <td>0.261</td>
      <td>5.0</td>
      <td>reviewed</td>
      <td>guc</td>
      <td>us</td>
      <td>Chile</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 22 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="aggregation">
<h2>Aggregation<a class="headerlink" href="#aggregation" title="Permalink to this headline">#</a></h2>
<p>Now that we know how to create a <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> object, let’s learn how to do aggregation on it.</p>
<p>One way us to use the <code class="docutils literal notranslate"><span class="pre">.aggregate</span></code> method, which accepts another function as its argument. The result is automatically combined into a new dataframe with the group key as the index.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>depth</th>
      <th>mag</th>
      <th>magType</th>
      <th>nst</th>
      <th>gap</th>
      <th>dmin</th>
      <th>rms</th>
      <th>...</th>
      <th>updated</th>
      <th>place</th>
      <th>type</th>
      <th>horizontalError</th>
      <th>depthError</th>
      <th>magError</th>
      <th>magNst</th>
      <th>status</th>
      <th>locationSource</th>
      <th>magSource</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Afghanistan</th>
      <td>2014-10-28 18:52:11.630000+00:00</td>
      <td>37.5010</td>
      <td>72.3338</td>
      <td>248.39</td>
      <td>5.6</td>
      <td>mww</td>
      <td>NaN</td>
      <td>172.0</td>
      <td>3.505</td>
      <td>1.49</td>
      <td>...</td>
      <td>2022-07-27T04:48:31.126Z</td>
      <td>Hindu Kush region, Afghanistan</td>
      <td>earthquake</td>
      <td>10.0</td>
      <td>12.4</td>
      <td>0.384</td>
      <td>236.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
    </tr>
    <tr>
      <th>Afghanistan-Tajikistan-Pakistan region</th>
      <td>2014-04-21 04:49:51.300000+00:00</td>
      <td>36.2863</td>
      <td>71.3573</td>
      <td>98.93</td>
      <td>4.3</td>
      <td>mb</td>
      <td>NaN</td>
      <td>72.0</td>
      <td>2.570</td>
      <td>1.37</td>
      <td>...</td>
      <td>2014-07-04T01:34:48.000Z</td>
      <td>Afghanistan-Tajikistan-Pakistan region</td>
      <td>earthquake</td>
      <td>NaN</td>
      <td>5.8</td>
      <td>0.096</td>
      <td>31.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
    </tr>
    <tr>
      <th>Alaska</th>
      <td>2014-10-30 22:08:40.190000+00:00</td>
      <td>68.0197</td>
      <td>179.4190</td>
      <td>234.20</td>
      <td>7.9</td>
      <td>mww</td>
      <td>NaN</td>
      <td>338.0</td>
      <td>6.339</td>
      <td>1.84</td>
      <td>...</td>
      <td>2024-01-17T21:08:44.760Z</td>
      <td>Rat Islands, Aleutian Islands, Alaska</td>
      <td>earthquake</td>
      <td>14.8</td>
      <td>22.2</td>
      <td>0.381</td>
      <td>621.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
    </tr>
    <tr>
      <th>Albania</th>
      <td>2014-05-20 04:43:25.500000+00:00</td>
      <td>41.5297</td>
      <td>20.2804</td>
      <td>21.00</td>
      <td>5.0</td>
      <td>mwr</td>
      <td>NaN</td>
      <td>38.0</td>
      <td>1.299</td>
      <td>1.23</td>
      <td>...</td>
      <td>2022-07-26T15:14:53.291Z</td>
      <td>18 km WSW of Mamurras, Albania</td>
      <td>earthquake</td>
      <td>NaN</td>
      <td>7.4</td>
      <td>0.265</td>
      <td>285.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
    </tr>
    <tr>
      <th>Algeria</th>
      <td>2014-08-22 00:22:46.420000+00:00</td>
      <td>36.9391</td>
      <td>5.6063</td>
      <td>15.60</td>
      <td>5.5</td>
      <td>mww</td>
      <td>NaN</td>
      <td>174.0</td>
      <td>3.250</td>
      <td>1.26</td>
      <td>...</td>
      <td>2022-08-07T00:52:43.784Z</td>
      <td>24 km SSE of Mostaganem, Algeria</td>
      <td>earthquake</td>
      <td>3.8</td>
      <td>6.2</td>
      <td>0.526</td>
      <td>15.0</td>
      <td>reviewed</td>
      <td>us</td>
      <td>us</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div></div></div>
</div>
<p>By default, the operation is applied to every column. That’s usually not what we want. We can use both <code class="docutils literal notranslate"><span class="pre">.</span></code> or <code class="docutils literal notranslate"><span class="pre">[]</span></code> syntax to select a specific column to operate on. Then we get back a series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">mag</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
Afghanistan                               5.6
Afghanistan-Tajikistan-Pakistan region    4.3
Alaska                                    7.9
Albania                                   5.0
Algeria                                   5.5
Name: mag, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">mag</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
Chile                                    8.2
Alaska                                   7.9
Solomon Islands                          7.6
Papua New Guinea                         7.5
El Salvador                              7.3
Mexico                                   7.2
southern East Pacific Rise               7.0
Federated States of Micronesia region    6.9
Fiji region                              6.9
Greece                                   6.9
Name: mag, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>There are shortcuts for common aggregation functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">mag</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
Chile                                    8.2
Alaska                                   7.9
Solomon Islands                          7.6
Papua New Guinea                         7.5
El Salvador                              7.3
Mexico                                   7.2
southern East Pacific Rise               7.0
Federated States of Micronesia region    6.9
Fiji region                              6.9
Greece                                   6.9
Name: mag, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">mag</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
California             4.01
MX                     4.01
Afghanistan            4.10
Alaska                 4.10
Albania                4.10
Algeria                4.10
Antigua and Barbuda    4.10
Argentina              4.10
Australia              4.10
Banda Sea              4.10
Name: mag, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">mag</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
California Earthquake             6.020000
Federated States of Micronesia    5.666667
Arizona                           5.300000
Easter Island region              5.162500
southern Iran                     5.100000
southern Peru                     5.100000
North Korea                       5.000000
South Georgia Island region       5.000000
northern Alaska                   5.000000
Bouvet Island region              4.985714
Name: mag, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">mag</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
northern Alaska                       1.131371
Federated States of Micronesia        0.929157
Bouvet Island region                  0.807111
California                            0.750920
South Indian Ocean                    0.708872
Oman                                  0.707107
southern East Pacific Rise            0.653818
Brazil                                0.636396
east of the South Sandwich Islands    0.624029
Wallis and Futuna                     0.616727
Name: mag, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>We can also apply multiple functions at once:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">mag</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Afghanistan</th>
      <td>4.1</td>
      <td>5.6</td>
      <td>4.387368</td>
    </tr>
    <tr>
      <th>Afghanistan-Tajikistan-Pakistan region</th>
      <td>4.3</td>
      <td>4.3</td>
      <td>4.300000</td>
    </tr>
    <tr>
      <th>Alaska</th>
      <td>4.1</td>
      <td>7.9</td>
      <td>4.544164</td>
    </tr>
    <tr>
      <th>Albania</th>
      <td>4.1</td>
      <td>5.0</td>
      <td>4.457143</td>
    </tr>
    <tr>
      <th>Algeria</th>
      <td>4.1</td>
      <td>5.5</td>
      <td>4.560000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">mag</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">])</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;country&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/pandas_groupby_34_1.png" src="../../_images/pandas_groupby_34_1.png" />
</div>
</div>
</section>
<section id="transformation">
<h2>Transformation<a class="headerlink" href="#transformation" title="Permalink to this headline">#</a></h2>
<p>The key difference between aggregation and transformation is that aggregation returns a <em>smaller</em> object than the original, indexed by the group keys, while <em>transformation</em> returns an object with the same index (and same size) as the original object. Groupby + transformation is used when applying an operation that requires information about the whole group.</p>
<p>In this example, we standardize the earthquakes in each country so that the distribution has zero mean and unit variance. We do this by first defining a function called <code class="docutils literal notranslate"><span class="pre">standardize</span></code> and then passing it to the <code class="docutils literal notranslate"><span class="pre">transform</span></code> method.</p>
<p>I admit that I don’t know why you would want to do this. <code class="docutils literal notranslate"><span class="pre">transform</span></code> makes more sense to me in the context of time grouping operation. See below for another example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">standardize</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">mag_standardized_by_country</span> <span class="o">=</span> <span class="n">gb</span><span class="o">.</span><span class="n">mag</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">standardize</span><span class="p">)</span>
<span class="n">mag_standardized_by_country</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>id
usc000swlj   -1.145807
usc000sta3   -0.651461
usc000st9z   -1.080123
usc000st9w    0.559124
usc000st92    1.012338
Name: mag, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-grouping">
<h2>Time Grouping<a class="headerlink" href="#time-grouping" title="Permalink to this headline">#</a></h2>
<p>We already saw how pandas has a strong built-in understanding of time. This capability is even more powerful in the context of <code class="docutils literal notranslate"><span class="pre">groupby</span></code>. With datasets indexed by a pandas <code class="docutils literal notranslate"><span class="pre">DateTimeIndex</span></code>, we can easily group and resample the data using common time units.</p>
<p>To get started, let’s load the timeseries data we already explored in past lessons.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">urllib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">header_url</span> <span class="o">=</span> <span class="s1">&#39;ftp://ftp.ncdc.noaa.gov/pub/data/uscrn/products/daily01/HEADERS.txt&#39;</span>
<span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">header_url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

<span class="n">ftp_base</span> <span class="o">=</span> <span class="s1">&#39;ftp://ftp.ncdc.noaa.gov/pub/data/uscrn/products/daily01/&#39;</span>
<span class="n">dframes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">2019</span><span class="p">):</span>
    <span class="n">data_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">/CRND0103-</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">-NY_Millbrook_3_W.txt&#39;</span>               
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ftp_base</span> <span class="o">+</span> <span class="n">data_url</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                     <span class="n">names</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span>
                     <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">9999.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">99.0</span><span class="p">])</span>
    <span class="n">dframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dframes</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;LST_DATE&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SUR_TEMP_DAILY_TYPE&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:15: SyntaxWarning: invalid escape sequence &#39;\s&#39;
&lt;&gt;:15: SyntaxWarning: invalid escape sequence &#39;\s&#39;
/tmp/ipykernel_62224/3171698157.py:15: SyntaxWarning: invalid escape sequence &#39;\s&#39;
  names=headers, header=None, sep=&#39;\s+&#39;,
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>WBANNO</th>
      <th>CRX_VN</th>
      <th>LONGITUDE</th>
      <th>LATITUDE</th>
      <th>T_DAILY_MAX</th>
      <th>T_DAILY_MIN</th>
      <th>T_DAILY_MEAN</th>
      <th>T_DAILY_AVG</th>
      <th>P_DAILY_CALC</th>
      <th>SOLARAD_DAILY</th>
      <th>...</th>
      <th>SOIL_MOISTURE_10_DAILY</th>
      <th>SOIL_MOISTURE_20_DAILY</th>
      <th>SOIL_MOISTURE_50_DAILY</th>
      <th>SOIL_MOISTURE_100_DAILY</th>
      <th>SOIL_TEMP_5_DAILY</th>
      <th>SOIL_TEMP_10_DAILY</th>
      <th>SOIL_TEMP_20_DAILY</th>
      <th>SOIL_TEMP_50_DAILY</th>
      <th>SOIL_TEMP_100_DAILY</th>
      <th></th>
    </tr>
    <tr>
      <th>LST_DATE</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016-01-01</th>
      <td>64756</td>
      <td>2.422</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>3.4</td>
      <td>-0.5</td>
      <td>1.5</td>
      <td>1.3</td>
      <td>0.0</td>
      <td>1.69</td>
      <td>...</td>
      <td>0.233</td>
      <td>0.204</td>
      <td>0.155</td>
      <td>0.147</td>
      <td>4.2</td>
      <td>4.4</td>
      <td>5.1</td>
      <td>6.0</td>
      <td>7.6</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2016-01-02</th>
      <td>64756</td>
      <td>2.422</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>2.9</td>
      <td>-3.6</td>
      <td>-0.4</td>
      <td>-0.3</td>
      <td>0.0</td>
      <td>6.25</td>
      <td>...</td>
      <td>0.227</td>
      <td>0.199</td>
      <td>0.152</td>
      <td>0.144</td>
      <td>2.8</td>
      <td>3.1</td>
      <td>4.2</td>
      <td>5.7</td>
      <td>7.4</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2016-01-03</th>
      <td>64756</td>
      <td>2.422</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>5.1</td>
      <td>-1.8</td>
      <td>1.6</td>
      <td>1.1</td>
      <td>0.0</td>
      <td>5.69</td>
      <td>...</td>
      <td>0.223</td>
      <td>0.196</td>
      <td>0.151</td>
      <td>0.141</td>
      <td>2.6</td>
      <td>2.8</td>
      <td>3.8</td>
      <td>5.2</td>
      <td>7.2</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2016-01-04</th>
      <td>64756</td>
      <td>2.422</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>0.5</td>
      <td>-14.4</td>
      <td>-6.9</td>
      <td>-7.5</td>
      <td>0.0</td>
      <td>9.17</td>
      <td>...</td>
      <td>0.220</td>
      <td>0.194</td>
      <td>0.148</td>
      <td>0.139</td>
      <td>1.7</td>
      <td>2.1</td>
      <td>3.4</td>
      <td>4.9</td>
      <td>6.9</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2016-01-05</th>
      <td>64756</td>
      <td>2.422</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>-5.2</td>
      <td>-15.5</td>
      <td>-10.3</td>
      <td>-11.7</td>
      <td>0.0</td>
      <td>9.34</td>
      <td>...</td>
      <td>0.213</td>
      <td>0.191</td>
      <td>0.148</td>
      <td>0.138</td>
      <td>0.4</td>
      <td>0.9</td>
      <td>2.4</td>
      <td>4.3</td>
      <td>6.6</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 27 columns</p>
</div></div></div>
</div>
<p>This timeseries has daily resolution, and the daily plots are somewhat noisy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">T_DAILY_MEAN</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;LST_DATE&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/pandas_groupby_41_1.png" src="../../_images/pandas_groupby_41_1.png" />
</div>
</div>
<p>A common way to analyze such data in climate science is to create a “climatology,” which contains the average values in each month or day of the year. We can do this easily with groupby. Recall that <code class="docutils literal notranslate"><span class="pre">df.index</span></code> is a pandas <code class="docutils literal notranslate"><span class="pre">DateTimeIndex</span></code> object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">monthly_climatology</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">monthly_climatology</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>WBANNO</th>
      <th>CRX_VN</th>
      <th>LONGITUDE</th>
      <th>LATITUDE</th>
      <th>T_DAILY_MAX</th>
      <th>T_DAILY_MIN</th>
      <th>T_DAILY_MEAN</th>
      <th>T_DAILY_AVG</th>
      <th>P_DAILY_CALC</th>
      <th>SOLARAD_DAILY</th>
      <th>...</th>
      <th>SOIL_MOISTURE_10_DAILY</th>
      <th>SOIL_MOISTURE_20_DAILY</th>
      <th>SOIL_MOISTURE_50_DAILY</th>
      <th>SOIL_MOISTURE_100_DAILY</th>
      <th>SOIL_TEMP_5_DAILY</th>
      <th>SOIL_TEMP_10_DAILY</th>
      <th>SOIL_TEMP_20_DAILY</th>
      <th>SOIL_TEMP_50_DAILY</th>
      <th>SOIL_TEMP_100_DAILY</th>
      <th></th>
    </tr>
    <tr>
      <th>LST_DATE</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>64756.0</td>
      <td>2.488667</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>2.924731</td>
      <td>-7.122581</td>
      <td>-2.100000</td>
      <td>-1.905376</td>
      <td>2.478495</td>
      <td>5.812258</td>
      <td>...</td>
      <td>0.240250</td>
      <td>0.200698</td>
      <td>0.153645</td>
      <td>0.160859</td>
      <td>0.150538</td>
      <td>0.248387</td>
      <td>0.788172</td>
      <td>1.766667</td>
      <td>3.364516</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>64756.0</td>
      <td>2.487882</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>6.431765</td>
      <td>-5.015294</td>
      <td>0.712941</td>
      <td>1.022353</td>
      <td>4.077647</td>
      <td>8.495882</td>
      <td>...</td>
      <td>0.247714</td>
      <td>0.210044</td>
      <td>0.159153</td>
      <td>0.163889</td>
      <td>1.216471</td>
      <td>1.169412</td>
      <td>1.278824</td>
      <td>1.617647</td>
      <td>2.442353</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>64756.0</td>
      <td>2.488667</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>7.953763</td>
      <td>-3.035484</td>
      <td>2.455914</td>
      <td>2.643011</td>
      <td>2.788172</td>
      <td>13.211290</td>
      <td>...</td>
      <td>0.228612</td>
      <td>0.203634</td>
      <td>0.157796</td>
      <td>0.160366</td>
      <td>3.450538</td>
      <td>3.400000</td>
      <td>3.372043</td>
      <td>3.480645</td>
      <td>3.777419</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>64756.0</td>
      <td>2.488667</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>14.793333</td>
      <td>1.816667</td>
      <td>8.302222</td>
      <td>8.574444</td>
      <td>2.396667</td>
      <td>15.295889</td>
      <td>...</td>
      <td>0.214067</td>
      <td>0.195844</td>
      <td>0.153878</td>
      <td>0.158100</td>
      <td>9.415556</td>
      <td>9.117778</td>
      <td>8.455556</td>
      <td>7.618889</td>
      <td>6.670000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>64756.0</td>
      <td>2.488667</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>21.235484</td>
      <td>8.460215</td>
      <td>14.850538</td>
      <td>15.121505</td>
      <td>3.015054</td>
      <td>17.288602</td>
      <td>...</td>
      <td>0.204796</td>
      <td>0.187097</td>
      <td>0.148871</td>
      <td>0.155720</td>
      <td>16.934409</td>
      <td>16.640860</td>
      <td>15.612903</td>
      <td>14.208602</td>
      <td>12.455914</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>64756.0</td>
      <td>2.488667</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>25.627778</td>
      <td>11.837778</td>
      <td>18.733333</td>
      <td>19.026667</td>
      <td>3.053333</td>
      <td>21.913333</td>
      <td>...</td>
      <td>0.136911</td>
      <td>0.135211</td>
      <td>0.129422</td>
      <td>0.152711</td>
      <td>22.403333</td>
      <td>22.126667</td>
      <td>20.956667</td>
      <td>19.448889</td>
      <td>17.552222</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>64756.0</td>
      <td>2.488667</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>28.568817</td>
      <td>15.536559</td>
      <td>22.054839</td>
      <td>22.012903</td>
      <td>3.865591</td>
      <td>21.570645</td>
      <td>...</td>
      <td>0.105806</td>
      <td>0.095204</td>
      <td>0.114419</td>
      <td>0.150000</td>
      <td>25.448387</td>
      <td>25.318280</td>
      <td>24.163441</td>
      <td>22.746237</td>
      <td>21.068817</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>64756.0</td>
      <td>2.488667</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>27.473118</td>
      <td>15.351613</td>
      <td>21.410753</td>
      <td>21.378495</td>
      <td>4.480645</td>
      <td>18.493333</td>
      <td>...</td>
      <td>0.156161</td>
      <td>0.132333</td>
      <td>0.128796</td>
      <td>0.158750</td>
      <td>24.758065</td>
      <td>24.829032</td>
      <td>24.116129</td>
      <td>23.325806</td>
      <td>22.301075</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>64756.0</td>
      <td>2.488667</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>24.084444</td>
      <td>12.032222</td>
      <td>18.057778</td>
      <td>17.866667</td>
      <td>3.730000</td>
      <td>13.625667</td>
      <td>...</td>
      <td>0.136900</td>
      <td>0.126422</td>
      <td>0.121356</td>
      <td>0.154000</td>
      <td>21.028889</td>
      <td>21.168889</td>
      <td>20.921111</td>
      <td>20.834444</td>
      <td>20.707778</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>10</th>
      <td>64756.0</td>
      <td>2.548882</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>18.127473</td>
      <td>5.757143</td>
      <td>11.938462</td>
      <td>11.952747</td>
      <td>3.228261</td>
      <td>9.442527</td>
      <td>...</td>
      <td>0.155275</td>
      <td>0.128462</td>
      <td>0.120187</td>
      <td>0.144588</td>
      <td>14.872527</td>
      <td>15.056044</td>
      <td>15.379121</td>
      <td>16.159341</td>
      <td>17.059341</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11</th>
      <td>64756.0</td>
      <td>2.555333</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>9.586667</td>
      <td>-1.375556</td>
      <td>4.097778</td>
      <td>4.277778</td>
      <td>3.991111</td>
      <td>6.350111</td>
      <td>...</td>
      <td>0.226111</td>
      <td>0.212200</td>
      <td>0.164778</td>
      <td>0.163078</td>
      <td>6.777778</td>
      <td>6.975556</td>
      <td>7.658889</td>
      <td>9.048889</td>
      <td>10.864444</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>12</th>
      <td>64756.0</td>
      <td>2.555333</td>
      <td>-73.74</td>
      <td>41.79</td>
      <td>3.569892</td>
      <td>-5.704301</td>
      <td>-1.069892</td>
      <td>-0.850538</td>
      <td>2.791398</td>
      <td>4.708602</td>
      <td>...</td>
      <td>0.259527</td>
      <td>0.221280</td>
      <td>0.171817</td>
      <td>0.177172</td>
      <td>1.831183</td>
      <td>2.009677</td>
      <td>2.647312</td>
      <td>3.910753</td>
      <td>5.710753</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>12 rows × 27 columns</p>
</div></div></div>
</div>
<p>Each row in this new dataframe respresents the average values for the months (1=January, 2=February, etc.)</p>
<p>We can apply more customized aggregations, as with any groupby operation. Below we keep the mean of the mean, max of the max, and min of the min for the temperature measurements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">monthly_T_climatology</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">({</span><span class="s1">&#39;T_DAILY_MEAN&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                                                              <span class="s1">&#39;T_DAILY_MAX&#39;</span><span class="p">:</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span>
                                                              <span class="s1">&#39;T_DAILY_MIN&#39;</span><span class="p">:</span> <span class="s1">&#39;min&#39;</span><span class="p">})</span>
<span class="n">monthly_T_climatology</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>T_DAILY_MEAN</th>
      <th>T_DAILY_MAX</th>
      <th>T_DAILY_MIN</th>
    </tr>
    <tr>
      <th>LST_DATE</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>-2.100000</td>
      <td>16.9</td>
      <td>-26.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.712941</td>
      <td>24.9</td>
      <td>-24.7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.455914</td>
      <td>26.8</td>
      <td>-16.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8.302222</td>
      <td>30.6</td>
      <td>-11.3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>14.850538</td>
      <td>33.4</td>
      <td>-1.6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">monthly_T_climatology</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;LST_DATE&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/pandas_groupby_46_1.png" src="../../_images/pandas_groupby_46_1.png" />
</div>
</div>
<p>If we want to do it on a finer scale, we can group by day of year.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">daily_T_climatology</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofyear</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">({</span><span class="s1">&#39;T_DAILY_MEAN&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;T_DAILY_MAX&#39;</span><span class="p">:</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;T_DAILY_MIN&#39;</span><span class="p">:</span> <span class="s1">&#39;min&#39;</span><span class="p">})</span>
<span class="n">daily_T_climatology</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;LST_DATE&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/pandas_groupby_48_1.png" src="../../_images/pandas_groupby_48_1.png" />
</div>
</div>
<section id="calculating-anomalies">
<h3>Calculating anomalies<a class="headerlink" href="#calculating-anomalies" title="Permalink to this headline">#</a></h3>
<p>A common mode of analysis in climate science is to remove the climatology from a signal to focus only on the “anomaly” values. This can be accomplished with transformation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">standardize</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">anomaly</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">standardize</span><span class="p">)</span>
<span class="n">anomaly</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;T_DAILY_MEAN&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;LST_DATE&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/pandas_groupby_50_1.png" src="../../_images/pandas_groupby_50_1.png" />
</div>
</div>
</section>
<section id="resampling">
<h3>Resampling<a class="headerlink" href="#resampling" title="Permalink to this headline">#</a></h3>
<p>Another common operation is to change the resolution of a dataset by resampling in time. Pandas exposes this through the <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#resampling">resample</a> function. The resample periods are specified using pandas <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#offset-aliases">offset index</a> syntax.</p>
<p>Below we resample the dataset by taking the mean over each month.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;T_DAILY_MEAN&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;LST_DATE&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/pandas_groupby_52_1.png" src="../../_images/pandas_groupby_52_1.png" />
</div>
</div>
<p>Just like with <code class="docutils literal notranslate"><span class="pre">groupby</span></code>, we can apply any aggregation function to our <code class="docutils literal notranslate"><span class="pre">resample</span></code> operation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;T_DAILY_MAX&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;LST_DATE&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/pandas_groupby_54_1.png" src="../../_images/pandas_groupby_54_1.png" />
</div>
</div>
</section>
<section id="rolling-operations">
<h3>Rolling Operations<a class="headerlink" href="#rolling-operations" title="Permalink to this headline">#</a></h3>
<p>The final category of operations applies to “rolling windows”. (See <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.rolling.html">rolling</a> documentation.) We specify a function to apply over a moving window along the index. We specify the size of the window and, optionally, the weights. We also use the keyword <code class="docutils literal notranslate"><span class="pre">centered</span></code> to tell pandas whether to center the operation around the midpoint of the window.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">T_DAILY_MEAN</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">win_type</span><span class="o">=</span><span class="s1">&#39;triang&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T_DAILY_MEAN</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;LST_DATE&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/pandas_groupby_56_1.png" src="../../_images/pandas_groupby_56_1.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "learning"
        },
        kernelOptions: {
            kernelName: "learning",
            path: "./lectures/pandas"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'learning'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../../assignments/basic_pandas.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Assignment: Pandas Fundamentals with Earthquake Data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../assignments/pandas_groupby.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Assignment: Pandas Groupby with Hurricane Data</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Adopted by Harold Gamarro<br/>
  
      &copy; Copyright Ryan Abernathey 2016-2021.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>